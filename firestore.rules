rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Public, read-only content (optional)
    match /public/{document=**} {
      allow read: if true;
      allow write: if false;
    }
    // Per-user private data
    match /users/{userId}/{doc=**} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    // Everything else locked down
    match /{document=**} {
      allow read, write: if false;
    }
  }
}

/*
SECURITY NOTES:
================

1. Client writes are BLOCKED for diagnostics and orders collections
   - All writes must go through server-side Firebase Admin SDK
   - This prevents tampering with diagnostic data or payment status

2. Users can only read their own data
   - Diagnostics: filtered by userId field
   - Orders: filtered by userId field
   - Prevents data leakage between customers

3. Email logs are completely private
   - No client access for privacy/security
   - Server-side logging only for debugging

4. Authentication required for all operations
   - Firebase ID tokens must be valid
   - Unauthenticated requests are denied

5. Admin collections are completely locked down
   - No client access to system/admin data
   - Server-side management only

DEPLOYMENT:
===========

Deploy these rules with:
  firebase deploy --only firestore:rules

Or via Firebase Console:
  https://console.firebase.google.com/project/YOUR_PROJECT/firestore/rules

TESTING:
========

Test with Firebase Emulator:
  firebase emulators:start --only firestore
  firebase firestore:rules:test

*/